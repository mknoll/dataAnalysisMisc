---
title: "Survival Analysis"
author: "Maximilian Knoll"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Demonstration of a survival analysis workflow using the dataAnalysisMisc 
package.

Aims: 
Easy survival analysis and visualization using standard tools
as kaplan-meier plots as well as forest plots for the visualization
of CoxPH models (uni and multivariate). Automatic model selection 
(multivariate) is supported. Patient characteristics tables are 
automatically created (tex file for easy adaption / pdf is pdflatex 
is available). 
Standard model assumptions hold true (e.g. no paired observations).

# Install and update the package

As bugs might be eleminated from time to time and functionality
might increase, an update might be a good idea :)

```{r eval}
# use devtools to get the package from github
# devtools installed?
if (!("devtools" %in% installed.packages())) install.packages("devtools")
devtools::install_github("mknoll/dataAnalysisMisc", dependencies=T)
```

# Load the package 
```{r}
require(dataAnalysisMisc)
```

# Exemplary data

We use the retinopathy data from the survival package and construct
a survival object. We treat events as death.

It is ignored in this case, that we do have two observations for each 
patients (left and right eye), we treat them as independent observations
from two patients. Don't do that with real data, go e.g. for an 
gee using cluster().

```{r}
require(survival)
data("retinopathy")

srv <- Surv(retinopathy$futime, retinopathy$status)
```

# Kaplan Meier

Median OS will be drawn if reached.
The offsetNRisk variable moves the number at risk table in y axis.

One group KM plots:

```{r}
plotKM(srv, rep("All", length(retinopathy[,1])), col="black", offsetNRisk=-0.1,
       xlab="Time [months]", ylab="OS")
```

More group KM plots:

```{r}
source("~/git/dataAnalysisMisc/R/plotKM.R")
plotKM(srv, retinopathy$laser, offsetNRisk=-0.1, ylab="OS", xlab="Time [months]")
```



